<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Stylus Input to Canvas</title>
  <style>
	* { margin: 0; padding: 0;}

	body, html { height:100%; }

	#fcanvas {
	    position:absolute;
	    width:100%;
	    height:100%;
	}
  </style>

</head>
<body>
<p id=pensize>---</p>
  <canvas id="canvas" width="500" height="500"></canvas>
  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let currentPath = [];
    let currentColor = 'black';
    let mouseIsDown = false;
    let penIsDown = false;
    
    //canvas.addEventListener('mousedown', startDrawing);
    //canvas.addEventListener('mousemove', draw);
    //canvas.addEventListener('mouseup', endDrawing);
    //canvas.addEventListener('touchstart', startDrawingTouch);
    //canvas.addEventListener('touchmove' , drawTouch);
    //canvas.addEventListener('touchup' , endDrawingTouch);
    canvas.addEventListener('pointerdown' , startDrawingTouch);
    canvas.addEventListener('pointermove' , drawTouch);
    canvas.addEventListener('pointerup' , endDrawingTouch);
    
    
    function processPointer(event)
    {
    document.getElementById("pensize").innerHTML = event.pressure;
    /*
    if (event.pressure === 0) {
      // No pressure
      process_no_pressure(event);
    } else if (event.pressure === 1) {
      // Maximum pressure
      process_max_pressure(event);
    } else {
      // Default
      process_pressure(event);
    }
    */
  }
    
    function startDrawing(event) {
      if (event.button === 0  // left button
         || event.targetTouches[0].radiusX === 0) {
          document.getElementById("pensize").innerHTML = "mousedraw";
        currentPath = [];
        mouseIsDown = true;
      }
    }
    
    function draw(event) {
      if (mouseIsDown) {
        const point = { 
          x: event.offsetX, 
          y: event.offsetY, 
          pressure: event.pressure 
        };
        currentPath.push(point);
        drawPath();
      }
    }
    
    function endDrawing(event) {
      if (event.button === 0 // left button
         || event.targetTouches[0].radiusX === 0) {

        mouseIsDown = false;
        writePathToCanvas();
      }
    }
    
    
    
    function startDrawingTouch(event) {
      //if (event.targetTouches[0].radiusX === 0 || true) {
      //   if (event.targetTouches.length>0)
      //    document.getElementById("pensize").innerHTML = event.targetTouches[0].radiusX;
      //   else
          document.getElementById("pensize").innerHTML = "pendown";
        currentPath = [];
        penIsDown = true;
     // }
    }
    
    function drawTouch(event) {
      //if (penIsDown) {
        const point = { 
          x: event.offsetX, 
          y: event.offsetY, 
          pressure: event.pressure 
        };
     //    if (event.targetTouches.length>0)
          document.getElementById("pensize").innerHTML = event.pressure;
      //   else
       //   document.getElementById("pensize").innerHTML = "no target touch radius -> no evaluation of pressure";
       if(event.pressure > 0.001)
       {
        currentPath.push(point);
        drawPath();
        }
     // }
    }
    
    function endDrawingTouch(event) {
    //  if (event.targetTouches[0].radiusX === 0 || true) {
	document.getElementById("pensize").innerHTML = "pen up";
        penIsDown = false;
        drawPath();
        //writePathToCanvas();
     // }
    }
    /*
    function writePathToCanvas() {
      if (currentPath.length > 1) {
        ctx.strokeStyle = currentColor;
        ctx.beginPath();
        ctx.moveTo(currentPath[0].x, currentPath[0].y);
        for (let i = 1; i < currentPath.length; i++) {
          const point = currentPath[i];
          ctx.lineWidth = point.pressure * 20;
          ctx.lineTo(point.x, point.y);
        }
        ctx.stroke();
      }
    }
    */
    function drawPath() {
      //ctx.clearRect(0, 0, canvas.width, canvas.height);
      if (currentPath.length > 1) {
        ctx.strokeStyle = currentColor;
        //ctx.lineWidth = currentPath[0].pressure * 20;
        
        for (let i = 1; i < currentPath.length; i++) {
          const point = currentPath[i];
          ctx.beginPath();
          ctx.moveTo(currentPath[i-1].x, currentPath[i-1].y);
          ctx.lineWidth = point.pressure * 20;
          ctx.lineTo(point.x, point.y);
          ctx.stroke();
        }
      }
    }
  </script>
</body>
</html>

